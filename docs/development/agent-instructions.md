# Инструкции для агента Cursor

## ⚠️ ВАЖНО: Обновленная версия проекта

Это **расширенная версия** таск-трекера с полным функционалом управления проектами. Проект значительно сложнее базового MVP.

## Главная задача

Создай Advanced Telegram Task Tracker Bot на Python согласно всей документации в этой папке.

## Порядок работы

1. **Прочитай всю документацию:**
   - **START_HERE.md** - начни отсюда
   - **ARCHITECTURE.md** - архитектура системы (ОБЯЗАТЕЛЬНО!)
   - **PROJECT_SPECIFICATION_V2.md** - полная спецификация функционала (ОБЯЗАТЕЛЬНО!)
   - **TECHNICAL_SPECIFICATION.md** - техническая спецификация
   - **IMPLEMENTATION_PLAN.md** - план реализации (будет обновлен)
   - **CONTEXT.md** - контекст проекта
   - **RULES.md** - правила разработки

2. **Изучи архитектуру:**
   - Структура базы данных (ARCHITECTURE.md)
   - Модели данных
   - Сервисы и репозитории
   - Потоки данных

3. **Следуй плану реализации:**
   - Начни с создания структуры БД
   - Реализуй модели данных
   - Создай репозитории
   - Реализуй сервисы
   - Создай handlers
   - Интегрируй все в bot.py

## Ключевые особенности проекта

### 1. Иерархия данных
```
User → Workspace → Board → Column → Task
                ↓
            Project → Tasks (на разных досках)
```

### 2. Проекты с автоматическими задачами
При создании проекта автоматически создаются задачи на всех досках пространства.

### 3. Синхронизация полей
Поля задач проекта синхронизируются автоматически между всеми задачами проекта.

### 4. Дашборд проекта
Проект имеет дашборд с этапами, который обновляется автоматически на основе колонок задач.

## Порядок реализации (рекомендуемый)

### Этап 1: База данных и модели
1. Создай все таблицы согласно ARCHITECTURE.md
2. Создай модели данных (models/)
3. Протестируй структуру БД

### Этап 2: Репозитории
1. Реализуй все репозитории (repositories/)
2. Протестируй CRUD операции

### Этап 3: Сервисы
1. Workspace Service
2. Board Service
3. Column Service
4. Project Service (с автоматическим созданием задач)
5. Task Service
6. Sync Service (синхронизация полей)
7. Statistics Service

### Этап 4: Handlers
1. Базовые команды (start, help)
2. Workspace handlers
3. Board handlers
4. Column handlers
5. Project handlers
6. Task handlers
7. Field handlers
8. Tag handlers
9. Statistics handlers

### Этап 5: Callbacks
1. Navigation callbacks
2. Task action callbacks
3. Board interaction callbacks
4. Project dashboard callbacks

### Этап 6: Утилиты
1. Keyboards (сложные клавиатуры для досок)
2. Formatters (форматирование досок, проектов)
3. Validators (валидация всех данных)
4. Board Visualizer (визуализация досок)

### Этап 7: Интеграция
1. Собери все в bot.py
2. Протестируй все функции
3. Исправь ошибки

## Важные моменты

### Синхронизация полей проекта
Это ключевая функция! При добавлении поля к задаче проекта:
1. Добавить поле к задаче
2. Найти все задачи проекта
3. Добавить поле ко всем задачам проекта
4. Сохранить в БД

### Автоматическое создание задач проекта
При создании проекта:
1. Создать проект
2. Найти все доски в пространстве
3. Для каждой доски создать задачу: "{project_id} {project_name} {board_name}"
4. Поместить задачи в первую колонку каждой доски
5. Связать задачи с проектом (project_id)

### Дашборд проекта
Этап проекта определяется автоматически на основе колонок задач:
- Если задача "Дизайн" в "Готово" → этап "Дизайн" завершен
- Если задача "Разработка" в "В работе" → текущий этап "Разработка"

### Визуализация досок
Создай функцию для текстового представления доски в формате Kanban:
- Колонки как столбцы
- Задачи в колонках
- Приоритеты и метки

## Критерии готовности

Бот готов, когда:

1. ✅ Все таблицы БД созданы
2. ✅ Все модели данных работают
3. ✅ Все репозитории работают
4. ✅ Все сервисы работают
5. ✅ Пространства работают
6. ✅ Доски и колонки работают
7. ✅ Проекты создаются с автоматическими задачами
8. ✅ Дашборд проекта работает
9. ✅ Синхронизация полей работает
10. ✅ Приоритеты и метки работают
11. ✅ Статистика работает
12. ✅ Визуализация досок работает
13. ✅ Поиск и фильтры работают
14. ✅ Все handlers работают
15. ✅ Все callbacks работают
16. ✅ Обработка ошибок работает
17. ✅ Валидация работает
18. ✅ Бот не падает при некорректных данных

## Если что-то не работает

1. Проверь логи на наличие ошибок
2. Убедись, что все таблицы БД созданы
3. Проверь связи между таблицами (FOREIGN KEY)
4. Убедись, что все импорты корректны
5. Проверь, что handlers правильно зарегистрированы
6. Проверь синхронизацию полей (может быть сложно)

## Использование промптов

Если застрял, используй промпты из PROMPTS.md для конкретных задач.

## Финальная проверка

Перед завершением убедись:

- [ ] Все таблицы БД созданы и работают
- [ ] Все модели данных работают
- [ ] Все репозитории работают
- [ ] Все сервисы работают
- [ ] Проекты создаются с автоматическими задачами
- [ ] Синхронизация полей работает
- [ ] Дашборд проекта обновляется автоматически
- [ ] Визуализация досок работает
- [ ] Все команды работают
- [ ] Все кнопки работают
- [ ] Валидация работает
- [ ] Ошибки обрабатываются
- [ ] Код соответствует RULES.md
- [ ] Документация актуальна

## Готово!

После завершения бот должен быть полностью функциональной системой управления проектами, готовой к использованию и дальнейшей интеграции AI-агента.
