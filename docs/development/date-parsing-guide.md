# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–∞—Ä—Å–∏–Ω–≥—É –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏

> **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-29  
> **–í–µ—Ä—Å–∏—è:** 1.0

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç](#–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ-—Ñ–æ—Ä–º–∞—Ç—ã-–¥–∞—Ç)
3. [–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏](#–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ-—Ñ–æ—Ä–º–∞—Ç—ã-–≤—Ä–µ–º–µ–Ω–∏)
4. [–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã](#–±–∏–±–ª–∏–æ—Ç–µ–∫–∏-–∏-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
5. [–ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä—Å–∏–Ω–≥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–ø–∞—Ä—Å–∏–Ω–≥–∞)
6. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
7. [–£—á–µ—Ç —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞](#—É—á–µ—Ç-—á–∞—Å–æ–≤–æ–≥–æ-–ø–æ—è—Å–∞)
8. [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)

---

## üéØ –û–±–∑–æ—Ä

–ü–∞—Ä—Å–µ—Ä –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏ (`DateParser`) –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–Ω –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä—Å–µ—Ä–∞:

1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞ ("–∑–∞–≤—Ç—Ä–∞", "03.12", "03.12.2025")
2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ ("10:00", "11:10 - 12:00")
3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
4. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üìÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç

### –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| `—Å–µ–≥–æ–¥–Ω—è` | "—Å–µ–≥–æ–¥–Ω—è" | –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ |
| `–∑–∞–≤—Ç—Ä–∞` | "–∑–∞–≤—Ç—Ä–∞" | –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ + 1 –¥–µ–Ω—å |
| `–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞` | "–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞" | –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ + 2 –¥–Ω—è |
| `–≤—á–µ—Ä–∞` | "–≤—á–µ—Ä–∞" | –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ - 1 –¥–µ–Ω—å |

### –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –¥–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| `DD.MM` | "03.12" | –î–∞—Ç–∞ –≤ —Ç–µ–∫—É—â–µ–º –≥–æ–¥—É |
| `DD.MM.YYYY` | "03.12.2025" | –ü–æ–ª–Ω–∞—è –¥–∞—Ç–∞ |
| `DD/MM` | "03/12" | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç |
| `DD/MM/YYYY` | "03/12/2025" | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç |
| `YYYY-MM-DD` | "2025-12-03" | ISO —Ñ–æ—Ä–º–∞—Ç |

### –î–Ω–∏ –Ω–µ–¥–µ–ª–∏

| –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| `–≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫` | "–≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫" | –ë–ª–∏–∂–∞–π—à–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ |
| `–≤ –ø—è—Ç–Ω–∏—Ü—É` | "–≤ –ø—è—Ç–Ω–∏—Ü—É" | –ë–ª–∏–∂–∞–π—à–∞—è –ø—è—Ç–Ω–∏—Ü–∞ |
| `–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫` | "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫" | –ë–ª–∏–∂–∞–π—à–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ —É–∂–µ –ø—Ä–æ—à–µ–ª –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ, –±–µ—Ä–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π.

---

## ‚è∞ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏

### –û–¥–Ω–æ –≤—Ä–µ–º—è

| –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| `HH:MM` | "10:00" | –ß–∞—Å –∏ –º–∏–Ω—É—Ç—ã |
| `HH:MM:SS` | "10:00:00" | –° —Å–µ–∫—É–Ω–¥–∞–º–∏ (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è) |
| `H:MM` | "9:30" | –ë–µ–∑ –≤–µ–¥—É—â–µ–≥–æ –Ω—É–ª—è |

### –î–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏

| –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| `HH:MM - HH:MM` | "11:10 - 12:00" | –ù–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü |
| `HH:MM‚ÄìHH:MM` | "11:10‚Äì12:00" | –° –¥–ª–∏–Ω–Ω—ã–º —Ç–∏—Ä–µ |
| `HH:MM –¥–æ HH:MM` | "11:10 –¥–æ 12:00" | –°–ª–æ–≤–æ "–¥–æ" |
| `—Å HH:MM –¥–æ HH:MM` | "—Å 11:10 –¥–æ 12:00" | –° –ø—Ä–µ–¥–ª–æ–≥–æ–º "—Å" |

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è

| –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|----------|
| `HH:MM –∏ HH:MM` | "10:00 –∏ 19:00" | –î–≤–∞ –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ "–∏" |
| `HH:MM, HH:MM` | "10:00, 19:00" | –î–≤–∞ –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

---

## üõ†Ô∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

1. **`dateutil`** - –º–æ—â–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç
   ```python
   from dateutil import parser
   from dateutil.relativedelta import relativedelta
   ```

2. **`datetime`** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python
   ```python
   from datetime import datetime, date, time, timedelta
   ```

3. **`re`** - —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   ```python
   import re
   ```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install python-dateutil
```

–ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ `requirements.txt`:
```
python-dateutil>=2.8.2
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä—Å–∏–Ω–≥–∞

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è –¥–∞—Ç–∞

**–í—Ö–æ–¥:** "–∑–∞–≤—Ç—Ä–∞"

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
from datetime import datetime, timedelta

today = datetime.now().date()
tomorrow = today + timedelta(days=1)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: date(2025, 11, 30)
```

### –ü—Ä–∏–º–µ—Ä 2: –î–∞—Ç–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º

**–í—Ö–æ–¥:** "03.12"

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
from datetime import datetime

date_str = "03.12"
current_year = datetime.now().year
full_date_str = f"{date_str}.{current_year}"
parsed_date = datetime.strptime(full_date_str, "%d.%m.%Y").date()
# –†–µ–∑—É–ª—å—Ç–∞—Ç: date(2025, 12, 3)
```

### –ü—Ä–∏–º–µ—Ä 3: –í—Ä–µ–º—è

**–í—Ö–æ–¥:** "10:00"

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
from datetime import time

time_str = "10:00"
parsed_time = datetime.strptime(time_str, "%H:%M").time()
# –†–µ–∑—É–ª—å—Ç–∞—Ç: time(10, 0)
```

### –ü—Ä–∏–º–µ—Ä 4: –î–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏

**–í—Ö–æ–¥:** "11:10 - 12:00"

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
import re

time_range_str = "11:10 - 12:00"
pattern = r'(\d{1,2}):(\d{2})\s*[-‚Äì]\s*(\d{1,2}):(\d{2})'
match = re.match(pattern, time_range_str)

if match:
    start_hour, start_min = int(match.group(1)), int(match.group(2))
    end_hour, end_min = int(match.group(3)), int(match.group(4))
    start_time = time(start_hour, start_min)
    end_time = time(end_hour, end_min)
    # –†–µ–∑—É–ª—å—Ç–∞—Ç: (time(11, 10), time(12, 0))
```

### –ü—Ä–∏–º–µ—Ä 5: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞—á–∏

**–í—Ö–æ–¥:** "–í—ã–≥—É–ª –§–µ—Ä—ã –≤ 10:00 –∏ 19:00"

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
import re

task_text = "–í—ã–≥—É–ª –§–µ—Ä—ã –≤ 10:00 –∏ 19:00"
time_pattern = r'(\d{1,2}):(\d{2})'
times = re.findall(time_pattern, task_text)

# –†–µ–∑—É–ª—å—Ç–∞—Ç: [('10', '00'), ('19', '00')]
# –°–æ–∑–¥–∞—é—Ç—Å—è –¥–≤–µ –∑–∞–¥–∞—á–∏: –æ–¥–Ω–∞ –Ω–∞ 10:00, –¥—Ä—É–≥–∞—è –Ω–∞ 19:00
```

### –ü—Ä–∏–º–µ—Ä 6: –î–∞—Ç–∞ –≤ —Ç–µ–∫—Å—Ç–µ –∑–∞–¥–∞—á–∏

**–í—Ö–æ–¥:** "5007 - –ü—Ä–æ–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É 03.12"

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```python
import re

task_text = "5007 - –ü—Ä–æ–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É 03.12"
date_pattern = r'(\d{1,2})\.(\d{1,2})(?:\.(\d{4}))?'
match = re.search(date_pattern, task_text)

if match:
    day, month = int(match.group(1)), int(match.group(2))
    year = int(match.group(3)) if match.group(3) else datetime.now().year
    parsed_date = date(year, month, day)
    # –†–µ–∑—É–ª—å—Ç–∞—Ç: date(2025, 12, 3)
    
    # –£–¥–∞–ª—è–µ–º –¥–∞—Ç—É –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞—á–∏
    cleaned_text = re.sub(date_pattern, '', task_text).strip()
    # –†–µ–∑—É–ª—å—Ç–∞—Ç: "5007 - –ü—Ä–æ–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É"
```

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç

```python
def validate_date(day: int, month: int, year: int) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞—Ç—ã"""
    try:
        date(year, month, day)
        return True
    except ValueError:
        return False
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

```python
def validate_time(hour: int, minute: int) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏"""
    return 0 <= hour < 24 and 0 <= minute < 60
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

```python
def parse_date_safe(text: str, default_date: Optional[date] = None) -> Optional[date]:
    """–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã —Å fallback"""
    try:
        # –ü–æ–ø—ã—Ç–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ dateutil
        parsed = parser.parse(text, default=default_date or datetime.now())
        return parsed.date()
    except (ValueError, TypeError):
        # Fallback –Ω–∞ —Ä—É—á–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥
        return parse_date_manual(text, default_date)
    except Exception as e:
        logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É '{text}': {e}")
        return default_date
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

```python
import logging

logger = logging.getLogger(__name__)

def parse_date_with_logging(text: str) -> Optional[date]:
    """–ü–∞—Ä—Å–∏–Ω–≥ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    try:
        result = parse_date(text)
        if result:
            logger.debug(f"–£—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–∞ –¥–∞—Ç–∞: '{text}' -> {result}")
        else:
            logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É: '{text}'")
        return result
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –¥–∞—Ç—ã '{text}': {e}", exc_info=True)
        return None
```

---

## üåç –£—á–µ—Ç —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
from datetime import datetime
import pytz

def get_user_timezone(user_id: int) -> pytz.timezone:
    """–ü–æ–ª—É—á–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
    # –î–ª—è –†–æ—Å—Å–∏–∏: pytz.timezone('Europe/Moscow')
    return pytz.timezone('Europe/Moscow')
```

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å —É—á–µ—Ç–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞

```python
def normalize_datetime(dt: datetime, user_timezone: pytz.timezone) -> datetime:
    """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å datetime —Å —É—á–µ—Ç–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞"""
    if dt.tzinfo is None:
        # –ï—Å–ª–∏ –≤—Ä–µ–º—è –±–µ–∑ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞, —Å—á–∏—Ç–∞–µ–º –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω—ã–º
        dt = user_timezone.localize(dt)
    return dt.astimezone(pytz.UTC)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ UTC
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from datetime import datetime
import pytz

# –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_time_str = "10:00"
user_date = date(2025, 11, 30)
user_time = datetime.strptime(user_time_str, "%H:%M").time()

# –°–æ–∑–¥–∞–Ω–∏–µ datetime —Å —É—á–µ—Ç–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
user_tz = pytz.timezone('Europe/Moscow')
user_datetime = user_tz.localize(
    datetime.combine(user_date, user_time)
)

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ UTC –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
utc_datetime = user_datetime.astimezone(pytz.UTC)
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–ª–∞—Å—Å–∞ DateParser

```python
"""
–ü–∞—Ä—Å–µ—Ä –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è Todo List
"""
import re
import logging
from datetime import datetime, date, time, timedelta
from typing import Optional, Tuple, Dict, Any
from dateutil import parser as dateutil_parser

logger = logging.getLogger(__name__)

class DateParser:
    """–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞"""
    
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –¥–∞—Ç
    DATE_PATTERNS = [
        (r'—Å–µ–≥–æ–¥–Ω—è', lambda ref: ref),
        (r'–∑–∞–≤—Ç—Ä–∞', lambda ref: ref + timedelta(days=1)),
        (r'–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞', lambda ref: ref + timedelta(days=2)),
        (r'–≤—á–µ—Ä–∞', lambda ref: ref - timedelta(days=1)),
        (r'(\d{1,2})\.(\d{1,2})(?:\.(\d{4}))?', None),  # DD.MM –∏–ª–∏ DD.MM.YYYY
    ]
    
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏
    TIME_PATTERN = r'(\d{1,2}):(\d{2})'
    TIME_RANGE_PATTERN = r'(\d{1,2}):(\d{2})\s*[-‚Äì]\s*(\d{1,2}):(\d{2})'
    
    def __init__(self, default_timezone='Europe/Moscow'):
        self.default_timezone = default_timezone
    
    def parse_date(self, text: str, reference_date: Optional[date] = None) -> Optional[date]:
        """
        –ü–∞—Ä—Å–∏—Ç –¥–∞—Ç—É –∏–∑ —Ç–µ–∫—Å—Ç–∞
        
        Args:
            text: –¢–µ–∫—Å—Ç —Å –¥–∞—Ç–æ–π
            reference_date: –û–ø–æ—Ä–Ω–∞—è –¥–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–≥–æ–¥–Ω—è)
        
        Returns:
            date –æ–±—ä–µ–∫—Ç –∏–ª–∏ None
        """
        if not reference_date:
            reference_date = datetime.now().date()
        
        text_lower = text.lower().strip()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞—Ç
        if text_lower == '—Å–µ–≥–æ–¥–Ω—è':
            return reference_date
        elif text_lower == '–∑–∞–≤—Ç—Ä–∞':
            return reference_date + timedelta(days=1)
        elif text_lower == '–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞':
            return reference_date + timedelta(days=2)
        elif text_lower == '–≤—á–µ—Ä–∞':
            return reference_date - timedelta(days=1)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ DD.MM –∏–ª–∏ DD.MM.YYYY
        date_match = re.search(r'(\d{1,2})\.(\d{1,2})(?:\.(\d{4}))?', text)
        if date_match:
            day = int(date_match.group(1))
            month = int(date_match.group(2))
            year = int(date_match.group(3)) if date_match.group(3) else reference_date.year
            
            try:
                return date(year, month, day)
            except ValueError:
                logger.warning(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞: {day}.{month}.{year}")
                return None
        
        # –ü–æ–ø—ã—Ç–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ dateutil
        try:
            parsed = dateutil_parser.parse(text, default=datetime.combine(reference_date, time()))
            return parsed.date()
        except (ValueError, TypeError):
            logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É: '{text}'")
            return None
    
    def parse_time(self, text: str) -> Optional[time]:
        """
        –ü–∞—Ä—Å–∏—Ç –≤—Ä–µ–º—è –∏–∑ —Ç–µ–∫—Å—Ç–∞
        
        Args:
            text: –¢–µ–∫—Å—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º (—Ñ–æ—Ä–º–∞—Ç HH:MM)
        
        Returns:
            time –æ–±—ä–µ–∫—Ç –∏–ª–∏ None
        """
        time_match = re.search(self.TIME_PATTERN, text)
        if time_match:
            hour = int(time_match.group(1))
            minute = int(time_match.group(2))
            
            if 0 <= hour < 24 and 0 <= minute < 60:
                return time(hour, minute)
            else:
                logger.warning(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è: {hour}:{minute}")
                return None
        
        return None
    
    def parse_time_range(self, text: str) -> Optional[Tuple[time, time]]:
        """
        –ü–∞—Ä—Å–∏—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏
        
        Args:
            text: –¢–µ–∫—Å—Ç —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º (—Ñ–æ—Ä–º–∞—Ç HH:MM - HH:MM)
        
        Returns:
            –ö–æ—Ä—Ç–µ–∂ (start_time, end_time) –∏–ª–∏ None
        """
        range_match = re.search(self.TIME_RANGE_PATTERN, text)
        if range_match:
            start_hour = int(range_match.group(1))
            start_min = int(range_match.group(2))
            end_hour = int(range_match.group(3))
            end_min = int(range_match.group(4))
            
            try:
                start_time = time(start_hour, start_min)
                end_time = time(end_hour, end_min)
                
                if start_time < end_time:
                    return (start_time, end_time)
                else:
                    logger.warning(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: {start_time} - {end_time}")
                    return None
            except ValueError:
                return None
        
        return None
    
    def parse_datetime_from_task(
        self,
        task_text: str,
        default_date: Optional[date] = None
    ) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞—á–∏
        
        Args:
            task_text: –¢–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏
            default_date: –î–∞—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        
        Returns:
            {
                "date": date,
                "time": time | None,
                "time_end": time | None,
                "remaining_text": str
            }
        """
        if not default_date:
            default_date = datetime.now().date()
        
        result = {
            "date": default_date,
            "time": None,
            "time_end": None,
            "remaining_text": task_text
        }
        
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã
        date_match = re.search(r'(\d{1,2})\.(\d{1,2})(?:\.(\d{4}))?', task_text)
        if date_match:
            day = int(date_match.group(1))
            month = int(date_match.group(2))
            year = int(date_match.group(3)) if date_match.group(3) else default_date.year
            
            try:
                result["date"] = date(year, month, day)
                # –£–¥–∞–ª—è–µ–º –¥–∞—Ç—É –∏–∑ —Ç–µ–∫—Å—Ç–∞
                result["remaining_text"] = re.sub(
                    r'\d{1,2}\.\d{1,2}(?:\.\d{4})?',
                    '',
                    result["remaining_text"]
                ).strip()
            except ValueError:
                pass
        
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏
        time_range = self.parse_time_range(task_text)
        if time_range:
            result["time"] = time_range[0]
            result["time_end"] = time_range[1]
            # –£–¥–∞–ª—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –∏–∑ —Ç–µ–∫—Å—Ç–∞
            result["remaining_text"] = re.sub(
                self.TIME_RANGE_PATTERN,
                '',
                result["remaining_text"]
            ).strip()
        else:
            # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            single_time = self.parse_time(task_text)
            if single_time:
                result["time"] = single_time
                # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º—è –∏–∑ —Ç–µ–∫—Å—Ç–∞
                result["remaining_text"] = re.sub(
                    self.TIME_PATTERN,
                    '',
                    result["remaining_text"]
                ).strip()
        
        return result
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](../specifications/todo-list-feature.md)
- [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤](agent-instructions-todo.md)
- [–¢–µ—Å—Ç-–ø–ª–∞–Ω](../testing/todo-list-test-plan.md)

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-01-29

