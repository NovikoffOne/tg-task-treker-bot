# Пошаговый план реализации: Telegram Task Tracker Bot

## Общий подход

Реализация будет происходить поэтапно, начиная с базовой структуры и постепенно добавляя функционал. Каждый этап должен быть протестирован перед переходом к следующему.

## Этап 1: Подготовка проекта (30 минут)

### Задачи:
1. ✅ Создать структуру папок
2. ✅ Создать базовые файлы (requirements.txt, .env.example, .gitignore)
3. ✅ Настроить виртуальное окружение
4. ✅ Установить зависимости

### Результат:
- Структура проекта создана
- Зависимости установлены
- Конфигурационные файлы готовы

---

## Этап 2: Базовая структура и конфигурация (30 минут)

### Задачи:
1. Создать `config.py` - конфигурация приложения
2. Создать `models.py` - модели данных (Task)
3. Создать базовый `bot.py` с минимальным функционалом
4. Создать `database.py` с инициализацией БД

### Результат:
- Бот запускается и отвечает на `/start`
- База данных создается при запуске
- Модели данных определены

### Код для проверки:
```python
# После этого этапа бот должен:
# - Отвечать на /start
# - Создавать БД при первом запуске
```

---

## Этап 3: База данных (45 минут)

### Задачи:
1. Реализовать `Database` класс в `database.py`
2. Реализовать методы:
   - `init_db()` - создание таблиц и индексов
   - `create_task()` - создание задачи
   - `get_task()` - получение задачи по ID
   - `get_user_tasks()` - получение задач пользователя с пагинацией
   - `update_task_status()` - обновление статуса
   - `update_task()` - обновление задачи
   - `delete_task()` - удаление задачи
3. Протестировать все методы БД

### Результат:
- Все операции с БД работают
- Данные корректно сохраняются и извлекаются
- Пагинация работает

### Тесты:
- Создать задачу → проверить в БД
- Получить задачу → проверить данные
- Обновить статус → проверить изменения
- Удалить задачу → проверить удаление

---

## Этап 4: Утилиты (30 минут)

### Задачи:
1. Создать `utils/keyboards.py`:
   - `main_menu_keyboard()` - главное меню
   - `task_actions_keyboard()` - кнопки действий
   - `pagination_keyboard()` - пагинация
   - `confirm_delete_keyboard()` - подтверждение удаления

2. Создать `utils/formatters.py`:
   - `format_task()` - форматирование одной задачи
   - `format_tasks_list()` - форматирование списка
   - `format_datetime()` - форматирование даты

3. Создать `utils/validators.py`:
   - `validate_title()` - валидация названия
   - `validate_description()` - валидация описания
   - `validate_task_id()` - валидация ID

### Результат:
- Все утилиты работают корректно
- Форматирование красивое и читаемое
- Валидация работает правильно

---

## Этап 5: Базовые команды (30 минут)

### Задачи:
1. Создать `handlers/start.py`:
   - `start_command()` - команда /start
   - `help_command()` - команда /help
   - `menu_command()` - команда /menu

2. Интегрировать в `bot.py`

### Результат:
- Команды /start, /help, /menu работают
- Показывается главное меню

---

## Этап 6: Создание задачи (45 минут)

### Задачи:
1. Создать `handlers/tasks.py`
2. Реализовать ConversationHandler для создания задачи:
   - `new_task_command()` - начало создания
   - `process_task_title()` - обработка названия
   - `process_task_description()` - обработка описания
3. Добавить валидацию
4. Интегрировать в `bot.py`

### Результат:
- Можно создать задачу через /newtask
- Валидация работает
- Задача сохраняется в БД

### Тесты:
- Создать задачу с названием и описанием
- Создать задачу только с названием (/skip)
- Попробовать создать с коротким названием (должна быть ошибка)

---

## Этап 7: Просмотр задач (45 минут)

### Задачи:
1. Реализовать команды просмотра в `handlers/tasks.py`:
   - `list_tasks_command()` - все задачи
   - `active_tasks_command()` - активные задачи
   - `done_tasks_command()` - завершенные задачи
2. Реализовать пагинацию
3. Добавить обработку кнопок пагинации в `handlers/callbacks.py`

### Результат:
- Можно просмотреть все задачи
- Фильтрация по статусу работает
- Пагинация работает

### Тесты:
- Просмотреть все задачи
- Просмотреть только активные
- Просмотреть только завершенные
- Проверить пагинацию (если задач больше 5)

---

## Этап 8: Изменение статуса (30 минут)

### Задачи:
1. Реализовать `done_task_command()` в `handlers/tasks.py`
2. Реализовать обработку callback `done_<id>` в `handlers/callbacks.py`
3. Добавить кнопки в сообщения с задачами

### Результат:
- Можно отметить задачу выполненной
- Статус меняется в БД
- Дата завершения сохраняется

### Тесты:
- Отметить задачу выполненной через команду
- Отметить через кнопку
- Проверить изменение статуса в БД

---

## Этап 9: Редактирование задачи (45 минут)

### Задачи:
1. Реализовать ConversationHandler для редактирования:
   - `edit_task_command()` - начало редактирования
   - `process_edit_task()` - обработка редактирования
2. Добавить обработку callback `edit_<id>`
3. Реализовать выбор поля (название/описание)

### Результат:
- Можно редактировать задачу
- Можно изменить название или описание
- Изменения сохраняются в БД

### Тесты:
- Редактировать название задачи
- Редактировать описание задачи
- Проверить изменения в БД

---

## Этап 10: Удаление задачи (30 минут)

### Задачи:
1. Реализовать `delete_task_command()` в `handlers/tasks.py`
2. Реализовать обработку callback `delete_<id>` и `confirm_delete_<id>` в `handlers/callbacks.py`
3. Добавить подтверждение удаления

### Результат:
- Можно удалить задачу
- Есть подтверждение перед удалением
- Задача удаляется из БД

### Тесты:
- Удалить задачу через команду
- Удалить через кнопку с подтверждением
- Отменить удаление
- Проверить удаление в БД

---

## Этап 11: Обработка inline-кнопок (30 минут)

### Задачи:
1. Завершить реализацию `handlers/callbacks.py`
2. Обработать все callback_data:
   - `done_<id>`, `edit_<id>`, `delete_<id>`
   - `confirm_delete_<id>`, `cancel_delete_<id>`
   - `page_<number>`, `list_tasks`, `main_menu`
3. Добавить обработку ошибок

### Результат:
- Все inline-кнопки работают
- Навигация работает
- Ошибки обрабатываются

### Тесты:
- Нажать все кнопки
- Проверить навигацию
- Проверить обработку несуществующих ID

---

## Этап 12: Полировка и тестирование (60 минут)

### Задачи:
1. Проверить все функции
2. Добавить обработку ошибок везде
3. Улучшить сообщения пользователю
4. Проверить валидацию
5. Протестировать все сценарии использования
6. Исправить найденные баги

### Результат:
- Все функции работают стабильно
- Ошибки обрабатываются корректно
- Интерфейс удобный и понятный

### Чеклист тестирования:
- [ ] Создание задачи работает
- [ ] Просмотр задач работает
- [ ] Фильтрация работает
- [ ] Изменение статуса работает
- [ ] Редактирование работает
- [ ] Удаление работает
- [ ] Пагинация работает
- [ ] Inline-кнопки работают
- [ ] Валидация работает
- [ ] Обработка ошибок работает
- [ ] Бот не падает при некорректных данных

---

## Итоговый чеклист

После завершения всех этапов должно быть:

1. ✅ Рабочий бот, который запускается
2. ✅ Все команды работают
3. ✅ База данных работает стабильно
4. ✅ Интерфейс удобный и понятный
5. ✅ Обработка ошибок реализована
6. ✅ Код чистый и документированный
7. ✅ Готовность к интеграции AI-агента

## Время реализации

**Общее время:** ~6-7 часов

- Этап 1: 30 мин
- Этап 2: 30 мин
- Этап 3: 45 мин
- Этап 4: 30 мин
- Этап 5: 30 мин
- Этап 6: 45 мин
- Этап 7: 45 мин
- Этап 8: 30 мин
- Этап 9: 45 мин
- Этап 10: 30 мин
- Этап 11: 30 мин
- Этап 12: 60 мин

## Рекомендации

1. **Не переходить к следующему этапу**, пока текущий не протестирован
2. **Коммитить после каждого этапа** для возможности отката
3. **Тестировать вручную** после каждого этапа
4. **Следовать правилам** из RULES.md
5. **Использовать промпты** из PROMPTS.md при затруднениях

